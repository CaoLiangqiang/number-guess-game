# Tasks - 双人联机模式开发

## Task 1: 主菜单界面修改
在主菜单增加"双人联机"按钮入口，保持与现有UI风格一致。
- [x] 修改 index.html 主菜单区域，添加"双人联机"按钮
- [x] 按钮样式与"挑战AI"按钮保持一致（渐变背景、悬停效果）
- [x] 添加点击事件处理函数 `game.showMultiplayerLobby()`

## Task 2: 联机大厅界面
创建联机大厅界面，支持创建房间和加入房间功能。
- [x] 创建 `multiplayerLobby` div 容器，初始状态 hidden
- [x] 实现"创建房间"按钮及点击处理
- [x] 实现"加入房间"输入框和按钮
- [x] 实现返回主菜单按钮
- [x] 添加大厅界面样式（与现有玻璃拟态风格一致）

## Task 3: 等待房间界面
创建等待房间界面，显示房间号和玩家状态。
- [x] 创建 `waitingRoom` div 容器
- [x] 显示6位房间号（大字体突出显示）
- [x] 实现"复制房间号"功能
- [x] 显示房主和客人状态（头像、准备状态）
- [x] 实现"取消等待"按钮
- [ ] 实现"开始游戏"按钮（仅房主可见，双方准备后可用）

## Task 4: WebSocket客户端模块
实现WebSocket通信模块，支持连接管理和消息收发。
- [x] 创建 `WebSocketClient` 类
- [x] 实现 `connect()` 方法，连接服务器
- [x] 实现心跳机制（1秒间隔发送ping）
- [x] 实现消息发送 `send(message)` 方法
- [x] 实现消息接收处理 `onMessage(callback)`
- [x] 实现连接断开检测和自动重连（最多5次，指数退避）
- [ ] 实现连接状态显示（UI指示器）

## Task 5: 房间管理系统
实现房间管理逻辑，处理创建、加入、离开房间。
- [x] 创建 `RoomManager` 类
- [x] 实现 `createRoom()` 方法，生成6位房间号
- [x] 实现 `joinRoom(roomId)` 方法
- [x] 实现 `leaveRoom()` 方法
- [x] 实现 `setReady(secret)` 方法，设置秘密数字并准备
- [x] 处理服务器房间状态更新消息

## Task 6: 联机游戏界面适配
基于现有游戏界面，适配联机模式显示。
- [x] 修改游戏界面，区分"你的回合"和"对方回合"
- [x] 添加对手信息区域（显示对手步数、网络状态）
- [x] 添加网络延迟显示（ping值）
- [x] 修改AI思考面板为"对战信息"面板
- [x] 实现对方猜测历史显示

## Task 7: 游戏状态同步
实现联机模式下的游戏状态同步逻辑。
- [x] 修改 `NumberGamePro` 类支持模式切换
- [x] 实现 `submitGuess()` 方法在联机模式下发送消息到服务器
- [x] 处理服务器返回的猜测结果消息
- [x] 处理回合切换消息
- [x] 处理游戏结束消息
- [x] 实现预测性渲染（本地先显示，等待服务器确认）

## Task 8: 断线重连功能
实现断线检测和自动重连机制。
- [x] 实现断线检测（心跳超时判断）
- [x] 实现自动重连UI（显示重连进度）
- [x] 实现重连后状态恢复
- [ ] 实现长时间断线判定对方获胜逻辑

## Task 9: 弱网适配
实现弱网环境下的自适应优化。
- [x] 实现网络质量检测（延迟、丢包率计算）
- [x] 实现自适应心跳间隔（网络差时延长间隔）
- [ ] 实现消息合并发送（网络差时批量发送）

## Task 10: 服务器配置
配置WebSocket服务器连接信息。
- [x] 创建 `config.js` 配置文件
- [x] 配置开发环境服务器地址
- [x] 配置生产环境服务器地址（GitHub Pages/Netlify）
- [x] 实现环境自动检测

# Task Dependencies
- Task 3 依赖 Task 2
- Task 4 依赖 Task 2
- Task 5 依赖 Task 4
- Task 6 依赖 Task 5
- Task 7 依赖 Task 6
- Task 8 依赖 Task 4
- Task 9 依赖 Task 4
